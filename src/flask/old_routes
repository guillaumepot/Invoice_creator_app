
## INVOICES
@app.route('/invoice/create', methods=['POST'])
@require_api_key
def create_invoice():
    api_key = session.get('api_key')
    company_collection = load_collection(api_key, 'Invoices')
    invoice = request.json
    company_collection.insert_one(invoice)
    return jsonify({"message": "Invoice created successfully"})


@app.route('/invoice/delete', methods=['GET'])
@require_api_key
def delete_invoice():
    api_key = session.get('api_key')
    company_collection = load_collection(api_key, 'Invoices')
    company_collection.delete_many({})
    return jsonify({"message": "All invoices deleted successfully"})


@app.route('/invoice/list', methods=['GET'])
@require_api_key
def list_invoices():
    api_key = session.get('api_key')
    company_collection = load_collection(api_key, 'Invoices')
    invoices = company_collection.find()
    invoices_list = [{
        "invoice_number": invoice.get('invoice_number'),
        "invoice_nb": invoice.get('invoice_nb'),
        "created_date": invoice.get('created_date'),
        "customer": invoice.get('customer'),
        "total": invoice.get('total')
    } for invoice in invoices]
    if not invoices_list:
        return jsonify({"invoices": [], "no_invoices": True})
    return jsonify({"invoices": invoices_list})


@app.route('/invoice/info/<invoice_number>', methods=['GET'])
@require_api_key
def get_invoice_info(invoice_number: str):
    api_key = session.get('api_key')
    company_collection = load_collection(api_key, 'Invoices')
    invoice_document = company_collection.find_one({'invoice_number': invoice_number})

    invoice_data = {
        'language': invoice_document.get('language') if invoice_document else 'en',
        'invoice_nb': invoice_document.get('invoice_nb') if invoice_document else None,
        'created_date': invoice_document.get('created_date') if invoice_document else None,
        'due_date': invoice_document.get('due_date') if invoice_document else None,
        'currency': invoice_document.get('currency') if invoice_document else 'â‚¬',
        'company': invoice_document.get('company') if invoice_document else None,
        'customer': invoice_document.get('customer') if invoice_document else None,
        'items': invoice_document.get('items') if invoice_document else None,
        'invoice_number': invoice_document.get('invoice_number') if invoice_document else None,
        'items': invoice_document.get('items') if invoice_document else None,
        'total': invoice_document.get('total') if invoice_document else None,
    }
    return jsonify(invoice_data)






